# AI旅行规划器系统架构

## 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        前端层 (Frontend)                        │
├─────────────────────────────────────────────────────────────────┤
│  • React/Vue.js 单页应用                                        │
│  • 地图交互界面 (高德地图)                                      │
│  • 语音输入组件 (Web Speech API)                               │
│  • 行程展示组件                                                │
└─────────────────────────────────────────────────────────────────┘
                                │
                                │ HTTP/HTTPS
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        API网关层 (Gateway)                      │
├─────────────────────────────────────────────────────────────────┤
│  • CORS处理                                                    │
│  • 请求日志记录                                                │
│  • 限流和熔断                                                  │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        应用层 (Application)                    │
├─────────────────────────────────────────────────────────────────┤
│  • 用户认证服务 (JWT)                                          │
│  • 旅行规划服务                                                │
│  • 语音识别服务                                                │
│  • 地图服务                                                    │
│  • 费用管理服务                                                │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        业务逻辑层 (Business)                    │
├─────────────────────────────────────────────────────────────────┤
│  • 用户管理逻辑                                                │
│  • 行程规划算法                                                │
│  • 费用预算分析                                                │
│  • 数据验证和转换                                              │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        数据访问层 (Data Access)                 │
├─────────────────────────────────────────────────────────────────┤
│  • Supabase客户端                                              │
│  • 数据模型映射                                                │
│  • 查询优化                                                    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        数据存储层 (Storage)                     │
├─────────────────────────────────────────────────────────────────┤
│  • Supabase PostgreSQL                                        │
│  • 用户数据                                                    │
│  • 旅行计划数据                                                │
│  • 费用记录                                                    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        外部服务层 (External Services)           │
├─────────────────────────────────────────────────────────────────┤
│  • OpenAI GPT-3.5 (行程规划)                                   │
│  • 科大讯飞 (语音识别)                                         │
│  • 高德地图 (地理位置服务)                                      │
└─────────────────────────────────────────────────────────────────┘
```

## 核心组件说明

### 1. 用户认证系统
- **JWT Token**: 无状态认证，支持token刷新
- **密码加密**: 使用bcrypt进行密码哈希
- **用户管理**: 注册、登录、资料管理

### 2. 智能行程规划
- **AI规划**: 基于OpenAI GPT-3.5生成个性化行程
- **偏好分析**: 解析用户偏好和需求
- **预算优化**: 根据预算自动调整行程安排

### 3. 语音交互
- **语音识别**: 科大讯飞API支持中文语音识别
- **意图理解**: 解析用户语音指令和需求
- **语音合成**: 支持语音反馈和播报

### 4. 地图服务
- **地点搜索**: 基于高德地图API的地点查询
- **路线规划**: 智能路线推荐和导航
- **附近服务**: 查找周边餐饮、住宿等服务

### 5. 费用管理
- **预算分析**: AI分析费用趋势和预算建议
- **费用记录**: 实时记录和分类费用
- **报表生成**: 自动生成费用统计报表

## 数据流设计

### 创建旅行计划流程
```
用户输入 → 语音识别 → 意图解析 → AI规划 → 地图验证 → 数据存储 → 结果返回
```

### 费用管理流程
```
费用录入 → 分类标记 → 预算对比 → 趋势分析 → 建议生成 → 报表展示
```

## 技术选型理由

### 后端框架: Go + Gin
- **高性能**: Go的并发特性适合高并发场景
- **简洁**: Gin框架轻量级，学习成本低
- **生态**: 丰富的第三方库支持

### 数据库: Supabase
- **PostgreSQL**: 强大的关系型数据库
- **实时同步**: 支持实时数据同步
- **认证集成**: 内置用户认证系统
- **API自动生成**: 自动生成RESTful API

### AI服务: OpenAI
- **GPT-3.5**: 强大的自然语言理解能力
- **中文支持**: 良好的中文处理能力
- **API稳定**: 可靠的云端服务

### 语音服务: 科大讯飞
- **中文优化**: 专门针对中文语音识别优化
- **准确率高**: 业界领先的识别准确率
- **实时性好**: 低延迟的语音处理

### 地图服务: 高德地图
- **国内优化**: 针对中国地理信息优化
- **功能丰富**: 完整的地图服务生态
- **价格合理**: 相对较低的API调用成本

## 安全设计

### 1. 认证安全
- JWT Token过期机制
- 密码加密存储
- 请求频率限制

### 2. 数据安全
- 数据库连接加密
- 敏感信息脱敏
- 数据备份策略

### 3. API安全
- 输入验证和过滤
- SQL注入防护
- XSS攻击防护

## 性能优化

### 1. 缓存策略
- Redis缓存热点数据
- 数据库查询结果缓存
- 静态资源CDN加速

### 2. 数据库优化
- 索引优化
- 查询语句优化
- 连接池管理

### 3. 并发处理
- Go协程池
- 异步任务处理
- 负载均衡

## 监控和日志

### 1. 应用监控
- 服务健康检查
- 性能指标监控
- 错误率统计

### 2. 日志管理
- 结构化日志
- 日志级别控制
- 日志轮转策略

### 3. 告警机制
- 服务异常告警
- 性能阈值告警
- 安全事件告警





